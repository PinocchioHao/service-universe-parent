<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.dao.SlotMapper">

    <resultMap id="SlotViewMap" type="com.example.entity.SlotView">
        <result column="id" property="id"/>
        <result column="centre_id" property="centreId"/>
        <result column="slot_time_fmt" property="slotTime"/>
        <result column="status" property="status"/>
    </resultMap>

    <select id="listAll" resultMap="SlotViewMap">
        SELECT id, centre_id,
               DATE_FORMAT(slot_time, '%Y-%m-%d %H:%i:%s') AS slot_time_fmt,
               status
        FROM booking_slot
        ORDER BY slot_time
    </select>

    <update id="holdSlot">
        UPDATE booking_slot
        SET status = 'HELD'
        WHERE centre_id = #{centreId}
          AND slot_time = #{slotTime}
          AND status = 'FREE'
    </update>

    <update id="bookSlot">
        UPDATE booking_slot
        SET status = 'BOOKED'
        WHERE centre_id = #{centreId}
          AND slot_time = #{slotTime}
          AND status = 'HELD'
    </update>

</mapper>
